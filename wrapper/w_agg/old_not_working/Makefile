CC=    gcc
CXX=   g++
LD=    g++

CFLAGS= -O3 -mssse3 -mpclmul -std=gnu99 -Wall -Wextra
CXXFLAGS= -O3 -mssse3 -mpclmul -Wall -Wextra
INCPATH= -I/usr/local/include -I/opt/local/include -I/usr/include
LDFLAGS= 
LIBPATH= -L/usr/local/lib -L/opt/local/lib -L/usr/lib
LIBS=    -lm -lcrypto

OBJ = t.o

CSRC= $(wildcard *.cpp)

ifdef NO_SSE
	CFLAGS += -D_NO_SSE_
	CXXFLAGS += -D_NO_SSE_
endif

ifdef AVX2
	CFLAGS += -mavx2 -D_USE_AVX2_
	CXXFLAGS += -mavx2 -D_USE_AVX2_
endif

ifdef AVX
	CFLAGS += -mavx -D_USE_AVX_
	CXXFLAGS += -mavx -D_USE_AVX_
endif

ifdef GPROF
	CFLAGS += -pg
	CXXFLAGS += -pg
	LDFLAGS += -pg
endif

.PHONY: all tests tables clean

all: $(OBJ)
#	cd TestAndBenchmark && $(MAKE) QUARTZ=$(QUARTZ1)

lib_c:
	$(CC) -o t.so -s -shared -O2 t.c -m64
	
lib_cpp:
	$(CXX) -o tpp.so -s -shared -O2 tpp.cpp -m64

%-test: $(OBJ) %-test.o
	$(LD) $(LDFLAGS) $(LIBPATH) -o $@ $^ $(LIBS)

%.o: %.c
	$(CC) $(CFLAGS) $(INCPATH) -c $<

%.o: %.cpp
	$(CXX) $(CXXFLAGS) $(INCPATH) -c $<

clean:
	rm *.o; rm *.so; rm *-test

